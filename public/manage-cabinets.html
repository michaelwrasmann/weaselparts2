<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeaselParts - Schr√§nke verwalten</title>
  <link rel="stylesheet" href="/css/modern-styles.css">
  <!-- Page Transitions -->
  <script src="/js/page-transitions.js"></script>
  <!-- Modal Animations -->
  <script src="/js/modal-animations.js"></script>
</head>
<body class="page-cabinets">

<div class="modern-container">
  <!-- Modern Header -->
  <header class="modern-header">
    <nav class="modern-nav">
      <a href="/" class="modern-logo">
        <img src="/images/weasel-svgrepo-com.svg" alt="WeaselParts">
        <span>WeaselParts</span>
      </a>
      
      <!-- Search Bar -->
      <div class="modern-search">
        <input type="text" placeholder="Bauteile suchen..." id="global-search">
      </div>
      
      <!-- Sensor Data -->
      <div class="modern-sensors">
        <div class="modern-sensor temp" id="temperature-value">--¬∞C</div>
        <div class="modern-sensor humid" id="humidity-value">--%</div>
        <select class="modern-select" id="sensor-location-select" style="width: auto; padding: 4px 8px;">
          <option value="ssa">Jarvis-Ecke</option>
          <option value="int_up">Am Telefon</option>
          <option value="emp">Empore</option>
        </select>
      </div>
      
      <!-- Navigation Buttons -->
      <div class="modern-nav-buttons">
        <button class="modern-nav-btn" id="add-component-nav-btn" title="Neues Bauteil">
          <img src="/images/button_add_component.png" alt="Neues Bauteil">
        </button>
        <button class="modern-nav-btn" id="manage-cabinets-nav-btn" title="Schr√§nke verwalten">
          <img src="/images/button_manage_cabinet.png" alt="Schr√§nke">
        </button>
        <a href="/ICD.html" class="modern-nav-btn" title="ICD">
          <img src="/images/button_icd.png" alt="ICD">
        </a>
        <a href="/lab-overview.html" class="modern-nav-btn" title="Labor-√úbersicht">
          <img src="/images/button_lab_overview.png" alt="Labor">
        </a>
        <a href="/glue-protocol.html" class="modern-nav-btn" title="Klebeprotokoll">
          <img src="/images/button_glue_protocol.png" alt="Kleben">
        </a>
        <a href="/settings.html" class="modern-nav-btn" title="Einstellungen">
          <img src="/images/button_settings.png" alt="Settings">
        </a>
      </div>
    </nav>
  </header>

  <!-- Split Screen Layout -->
  <div class="modern-wrapper">
    <!-- Content Panel - Left Side 70% -->
    <div class="content-panel">
      <div class="modern-content">
        
        <!-- Page Header -->
        <div class="modern-page-header">
          <h1 class="modern-title">Schr√§nke verwalten</h1>
        </div>

        <!-- Statistics -->
        <div class="modern-panel stats-container">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
              </div>
              <div class="stat-content">
                <div class="stat-value" id="total-cabinets">0</div>
                <div class="stat-label">Schr√§nke</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <svg width="40" height="40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                </svg>
              </div>
              <div class="stat-content">
                <div class="stat-value" id="total-components">0</div>
                <div class="stat-label">Bauteile eingelagert</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add New Cabinet -->
        <div class="modern-panel">
          <div class="section-header">
            <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0; display: flex; align-items: center; gap: var(--space-sm);">
              <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Neuen Schrank hinzuf√ºgen
            </h2>
          </div>
          
          <form id="new-cabinet-form" class="add-cabinet-form" style="display: flex; gap: var(--space-lg); align-items: end;">
            <div class="modern-form-group" style="flex: 1; margin-bottom: 0;">
              <label class="modern-label" for="cabinet-name">Schrankname:</label>
              <input 
                type="text" 
                id="cabinet-name" 
                name="name" 
                placeholder="Gib einen Namen f√ºr den neuen Schrank ein" 
                required
                class="modern-input">
            </div>
            <button type="submit" class="modern-btn modern-btn-primary">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
              </svg>
              Schrank erstellen
            </button>
          </form>
        </div>

        <!-- Existing Cabinets -->
        <div class="modern-panel">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl);">
            <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0; display: flex; align-items: center; gap: var(--space-sm);">
              <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
              </svg>
              Vorhandene Schr√§nke
            </h2>
            <button class="modern-btn modern-btn-secondary" onclick="exportAllCabinets()">
              <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              Alle exportieren
            </button>
          </div>
          
          <div class="cabinets-grid modern-grid modern-grid-2" id="cabinets-grid">
            <!-- Schr√§nke werden dynamisch geladen -->
          </div>
          
          <div id="no-cabinets" class="modern-empty-state" style="display: none;">
            <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
            <h3>Keine Schr√§nke gefunden</h3>
            <p>F√ºge zuerst einen Schrank hinzu, um Bauteile einzulagern.</p>
          </div>
        </div>

      </div>
    </div>
    
    <!-- Background Panel - Right Side 30% -->
    <div class="background-panel">
      <img src="/images/background_icon_manage_cabinet.png" alt="Manage Cabinets Icon" class="background-icon cabinet-bg-icon" onerror="this.src='/images/background_icon_lab_overview.png'">
    </div>
  </div>
</div>

<!-- Cabinet Details Modal -->
<div id="cabinet-details-modal" class="modal modern-modal">
  <div class="modal-content modern-modal-content" style="max-width: 900px;">
    <div class="modal-header modern-modal-header modal-titlebar">
      <h3 id="cabinet-modal-title">Schrank Details</h3>
      <button class="modal-close-btn close-modal" id="close-cabinet-details">‚úï</button>
    </div>
    
    <div class="modal-body modern-modal-body">
      <div class="cabinet-contents-section">
        <div class="contents-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg);">
          <h4 style="font-size: 1.25rem; font-weight: 600; margin: 0; display: flex; align-items: center; gap: var(--space-sm);">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v11a2 2 0 002 2h2M9 5a2 2 0 012 2v11a2 2 0 01-2 2M9 5a2 2 0 012-2h2a2 2 0 012 2M15 19h2a2 2 0 002-2V7a2 2 0 00-2-2h-2m-6 0h6"></path>
            </svg>
            Inhalt (<span id="contents-count">0</span> Bauteile)
          </h4>
          <button class="modern-btn modern-btn-secondary" id="export-contents">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Liste exportieren
          </button>
        </div>
        
        <div class="contents-table-container">
          <table class="modern-table" id="contents-table">
            <thead>
              <tr>
                <th>Bild</th>
                <th>Barcode</th>
                <th>Name</th>
                <th>Projekt</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody id="contents-tbody">
              <!-- Inhalte werden dynamisch geladen -->
            </tbody>
          </table>
        </div>
        
        <div id="empty-cabinet" class="modern-empty-state" style="display: none;">
          <p>Dieser Schrank ist leer.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Edit Cabinet Modal -->
<div id="edit-cabinet-modal" class="modal modern-modal">
  <div class="modal-content modern-modal-content">
    <div class="modal-header modern-modal-header modal-titlebar">
      <h3>Schrank bearbeiten</h3>
      <button class="modal-close-btn close-modal" id="close-edit-cabinet">‚úï</button>
    </div>
    
    <div class="modal-body modern-modal-body">
      <form id="edit-cabinet-form">
        <div class="modern-form-group">
          <label class="modern-label" for="edit-cabinet-name">Schrankname:</label>
          <input 
            type="text" 
            id="edit-cabinet-name" 
            name="name" 
            placeholder="Neuer Schrankname" 
            required
            class="modern-input">
        </div>
        
        <div class="modern-form-group">
          <label class="modern-label" for="cabinet-image">Schrank-Foto:</label>
          <div class="image-upload-container">
            <div class="current-image-section">
              <div id="current-cabinet-image">
                <p class="no-current-image">Kein Foto vorhanden</p>
              </div>
            </div>
            
            <div class="modern-image-container" onclick="document.getElementById('cabinet-image-input').click()" style="cursor: pointer; margin-top: var(--space-md);">
              <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="60" height="60">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              <p style="margin: var(--space-md) 0;">Foto hochladen</p>
              <span style="font-size: 0.875rem; color: var(--gray-500);">JPG, PNG oder GIF (max. 5MB)</span>
            </div>
            
            <input 
              type="file" 
              id="cabinet-image-input" 
              accept="image/*" 
              style="display: none;"
              onchange="handleCabinetImageSelect(event)">
            
            <div id="cabinet-image-preview" class="image-preview"></div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer modern-modal-footer">
      <button type="button" class="modern-btn modern-btn-secondary" onclick="closeEditCabinet()">Abbrechen</button>
      <button type="submit" class="modern-btn modern-btn-primary" form="edit-cabinet-form">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        Speichern
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-confirmation-modal" class="modal modern-modal">
  <div class="modal-content modern-modal-content" style="max-width: 500px;">
    <div class="modal-header modern-modal-header modal-titlebar">
      <h3>Schrank l√∂schen</h3>
      <button class="modal-close-btn close-modal" id="close-delete-confirmation">‚úï</button>
    </div>
    
    <div class="modern-modal-body" style="text-align: center;">
      <div style="margin-bottom: var(--space-lg);">
        <svg width="60" height="60" fill="none" stroke="#FF6B6B" viewBox="0 0 24 24" style="margin: 0 auto;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
      </div>
      
      <div style="margin-bottom: var(--space-xl);">
        <p style="margin-bottom: var(--space-md); font-size: 1.125rem;" id="delete-confirmation-message">M√∂chten Sie diesen Schrank wirklich l√∂schen?</p>
        <div style="background: #FFF3F3; border: 1px solid #FFB3B3; border-radius: var(--radius-md); padding: var(--space-md);">
          <strong>Achtung:</strong> Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.
        </div>
      </div>
    </div>
      
    <div class="modal-footer modern-modal-footer">
      <button class="modern-btn modern-btn-secondary" id="cancel-delete">Abbrechen</button>
      <button class="modern-btn modern-btn-primary" id="confirm-delete" style="background: #FF6B6B; border-color: #FF6B6B;">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        L√∂schen
      </button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Scripts -->
<script src="/js/api.js"></script>
<script src="/js/common.js"></script>

<script>
let cabinets = [];
let currentViewingCabinetId = null;
let currentCabinetToDelete = null;
let currentEditingCabinet = null;

document.addEventListener('DOMContentLoaded', async () => {
  console.log('üè¢ Manage Cabinets wird initialisiert...');
  
  forceCloseAllModals();

  try {
    await initializePage();
    await loadSensorData();
    startSensorRefresh();
    console.log('‚úÖ Manage Cabinets erfolgreich initialisiert');
  } catch (error) {
    console.error('‚ùå Initialisierungsfehler:', error);
    showMessage('Fehler beim Laden der Seite', 'error');
  }
});

function forceCloseAllModals() {
  console.log('üîß Zwinge alle Modals zum Schlie√üen...');
  
  const modalSelectors = [
    '#cabinet-details-modal',
    '#edit-cabinet-modal',
    '#delete-confirmation-modal',
    '#scanner-modal',
    '.modal'
  ];
  
  modalSelectors.forEach(selector => {
    document.querySelectorAll(selector).forEach(modal => {
      modal.classList.remove('active');
      modal.style.display = 'none';
      modal.style.opacity = '0';
      modal.style.visibility = 'hidden';
    });
  });
  
  console.log('‚úÖ Alle Modals geschlossen');
}

async function initializePage() {
  setupEventListeners();
  await loadCabinets();
  await updateStats();
}

function setupEventListeners() {
  console.log('üîß Event Listeners werden eingerichtet...');
  
  // Navigation Buttons - Let page-transitions.js handle these
  
  // Global Search
  const globalSearch = document.getElementById('global-search');
  if (globalSearch) {
    globalSearch.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.target.value.trim()) {
        window.location.href = `/?search=${encodeURIComponent(e.target.value)}`;
      }
    });
  }
  
  // Sensor Location Dropdown
  const locationSelect = document.getElementById('sensor-location-select');
  if (locationSelect) {
    locationSelect.addEventListener('change', async () => {
      await loadSensorData();
    });
  }
  
  // Formular f√ºr neuen Schrank
  const form = document.getElementById('new-cabinet-form');
  if (form) {
    form.addEventListener('submit', handleAddCabinet);
  }

  // Edit Cabinet Form
  const editForm = document.getElementById('edit-cabinet-form');
  if (editForm) {
    editForm.addEventListener('submit', handleEditCabinet);
  }
  
  // Modal Event Listeners
  setupModalEventListeners();
  
  console.log('‚úÖ Event Listeners eingerichtet');
}


function setupModalEventListeners() {
  // Cabinet Details Modal
  const closeCabinetBtn = document.getElementById('close-cabinet-details');
  if (closeCabinetBtn) {
    closeCabinetBtn.addEventListener('click', closeCabinetDetails);
  }

  // Edit Cabinet Modal
  const closeEditBtn = document.getElementById('close-edit-cabinet');
  if (closeEditBtn) {
    closeEditBtn.addEventListener('click', closeEditCabinet);
  }

  // Delete Confirmation Modal
  const closeDeleteBtn = document.getElementById('close-delete-confirmation');
  if (closeDeleteBtn) {
    closeDeleteBtn.addEventListener('click', closeDeleteConfirmation);
  }

  const confirmDeleteBtn = document.getElementById('confirm-delete');
  if (confirmDeleteBtn) {
    confirmDeleteBtn.addEventListener('click', handleConfirmDelete);
  }

  const cancelDeleteBtn = document.getElementById('cancel-delete');
  if (cancelDeleteBtn) {
    cancelDeleteBtn.addEventListener('click', closeDeleteConfirmation);
  }
  
  // Export Button
  const exportBtn = document.getElementById('export-contents');
  if (exportBtn) {
    exportBtn.addEventListener('click', () => {
      if (currentViewingCabinetId) {
        exportCabinetContents(currentViewingCabinetId);
      } else {
        showMessage('Fehler: Kein Schrank ausgew√§hlt', 'error');
      }
    });
  }

  // Escape key to close modals
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeCabinetDetails();
      closeEditCabinet();
      closeDeleteConfirmation();
    }
  });

  // Click outside to close modals
  document.querySelectorAll('.modern-modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeCabinetDetails();
        closeEditCabinet();
        closeDeleteConfirmation();
      }
    });
  });
}

async function loadCabinets() {
  try {
    console.log('üìä Lade Schr√§nke...');
    cabinets = await api.getCabinets();
    
    // F√ºr jeden Schrank die Anzahl der Bauteile laden
    for (let cabinet of cabinets) {
      try {
        const contents = await api.getCabinetContents(cabinet.id);
        cabinet.componentCount = contents.length;
        cabinet.components = contents;
      } catch (error) {
        console.warn(`‚ö†Ô∏è Fehler beim Laden von Schrank ${cabinet.id}:`, error);
        cabinet.componentCount = 0;
        cabinet.components = [];
      }
    }
    
    renderCabinets();
    console.log(`‚úÖ ${cabinets.length} Schr√§nke geladen`);
  } catch (error) {
    console.error('‚ùå Fehler beim Laden der Schr√§nke:', error);
    showMessage(`Fehler beim Laden der Schr√§nke: ${error.message}`, 'error');
    
    cabinets = [];
    renderCabinets();
  }
}

function renderCabinets() {
  const grid = document.getElementById('cabinets-grid');
  const noCabinets = document.getElementById('no-cabinets');
  
  if (!grid) {
    console.error('‚ùå Cabinets Grid nicht gefunden');
    return;
  }

  grid.innerHTML = '';
  
  if (cabinets.length === 0) {
    if (noCabinets) noCabinets.style.display = 'block';
    return;
  }
  
  if (noCabinets) noCabinets.style.display = 'none';
  
  cabinets.forEach(cabinet => {
    try {
      const cabinetCard = createCabinetCard(cabinet);
      grid.appendChild(cabinetCard);
    } catch (error) {
      console.error('Fehler beim Erstellen der Schrank-Karte:', error);
    }
  });
}

function createCabinetCard(cabinet) {
  const card = document.createElement('div');
  card.className = 'modern-card component-card';
  card.dataset.cabinetId = cabinet.id;
  card.style.position = 'relative';
  card.style.paddingTop = '200px';
  
  const isEmpty = cabinet.componentCount === 0;
  
  // Image section (larger for better cabinet visibility)
  let imageSection;
  if (cabinet.image_url && cabinet.image_url.trim() !== '') {
    imageSection = `
      <div style="position: absolute; top: 0; left: 0; right: 0; height: 200px; overflow: hidden;">
        <img src="${cabinet.image_url}" 
             alt="${cabinet.name || 'Schrank'}" 
             style="width: 100%; height: 200px; object-fit: cover;"
             loading="lazy">
      </div>
    `;
  } else {
    imageSection = `<div style="position: absolute; top: 0; left: 0; right: 0; height: 200px; display: flex; align-items: center; justify-content: center; color: var(--gray-400); background: var(--gray-50);">Kein Bild</div>`;
  }
  
  card.innerHTML = `
    ${imageSection}
    <div class="modern-card-content">
      <h3 class="modern-card-title">${cabinet.name}</h3>
      <p class="modern-card-subtitle">Status: ${isEmpty ? 'Leer' : `${cabinet.componentCount} Bauteile`}</p>
      <div class="modern-card-details">
        <div class="modern-actions">
          <button class="modern-action-btn" onclick="window.viewCabinetDetails(${cabinet.id})" title="Details anzeigen">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
          </button>
          <button class="modern-action-btn edit" onclick="window.editCabinet(${cabinet.id})" title="Bearbeiten">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
          </button>
          <button class="modern-action-btn delete" onclick="window.showCabinetDeleteConfirmation(${cabinet.id})" title="L√∂schen">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  `;
  
  return card;
}

async function handleAddCabinet(e) {
  e.preventDefault();
  
  const form = e.target;
  const nameInput = form.querySelector('#cabinet-name');
  if (!nameInput) {
    showMessage('Formular-Fehler: Name-Eingabe nicht gefunden', 'error');
    return;
  }
  
  const name = nameInput.value.trim();
  
  if (!name) {
    showMessage('Bitte gib einen Namen f√ºr den Schrank ein.', 'warning');
    nameInput.focus();
    return;
  }
  
  if (name.length < 2) {
    showMessage('Der Schrankname muss mindestens 2 Zeichen lang sein.', 'warning');
    nameInput.focus();
    return;
  }
  
  try {
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn ? submitBtn.innerHTML : '';
    
    if (submitBtn) {
      submitBtn.innerHTML = '<div class="modern-loading"></div> Erstellt...';
      submitBtn.disabled = true;
    }
    
    const newCabinet = await api.createCabinet({ name });
    newCabinet.componentCount = 0;
    newCabinet.components = [];
    
    cabinets.push(newCabinet);
    
    showMessage(`Schrank "${name}" wurde erfolgreich erstellt.`, 'success');
    
    nameInput.value = '';
    renderCabinets();
    await updateStats();
    
    if (submitBtn) {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
    
  } catch (error) {
    console.error('Fehler beim Erstellen des Schranks:', error);
    
    if (error.message.includes('existiert bereits')) {
      showMessage(`Ein Schrank mit dem Namen "${name}" existiert bereits.`, 'warning');
    } else {
      showMessage(`Fehler beim Erstellen des Schranks: ${error.message}`, 'error');
    }
    
    const submitBtn = form.querySelector('button[type="submit"]');
    if (submitBtn) {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  }
}

// EDIT CABINET FUNCTIONALITY
function editCabinet(cabinetId) {
  const cabinet = cabinets.find(c => c.id === cabinetId);
  if (!cabinet) {
    showMessage('Schrank nicht gefunden', 'error');
    return;
  }
  
  currentEditingCabinet = cabinet;
  
  // Fill form with current data
  const nameInput = document.getElementById('edit-cabinet-name');
  if (nameInput) {
    nameInput.value = cabinet.name;
  }
  
  // Show current image
  const currentImageContainer = document.getElementById('current-cabinet-image');
  if (currentImageContainer) {
    if (cabinet.image_url) {
      currentImageContainer.innerHTML = `
        <div style="position: relative; display: inline-block;">
          <img src="${cabinet.image_url}" alt="${cabinet.name}" style="max-width: 200px; max-height: 150px; border-radius: var(--radius-md);">
          <button type="button" onclick="removeCabinetImage()" style="position: absolute; top: 8px; right: 8px; width: 32px; height: 32px; background: rgba(255, 107, 107, 0.9); border: none; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
        </div>
      `;
    } else {
      currentImageContainer.innerHTML = '<p style="color: var(--gray-500); font-style: italic;">Kein Foto vorhanden</p>';
    }
  }
  
  openModal('edit-cabinet-modal');
}

async function handleEditCabinet(e) {
  e.preventDefault();
  
  if (!currentEditingCabinet) {
    showMessage('Fehler: Kein Schrank ausgew√§hlt', 'error');
    return;
  }
  
  const form = e.target;
  const nameInput = form.querySelector('#edit-cabinet-name');
  const name = nameInput.value.trim();
  
  if (!name) {
    showMessage('Bitte gib einen Namen ein.', 'warning');
    nameInput.focus();
    return;
  }
  
  if (name.length < 2) {
    showMessage('Der Name muss mindestens 2 Zeichen lang sein.', 'warning');
    nameInput.focus();
    return;
  }
  
  try {
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<div class="modern-loading"></div> Speichert...';
    submitBtn.disabled = true;
    
    // Update cabinet name via API (you'll need to implement this endpoint)
    await updateCabinetName(currentEditingCabinet.id, name);
    
    // Handle image upload if selected
    const imageInput = document.getElementById('cabinet-image-input');
    if (imageInput.files.length > 0) {
      await uploadCabinetImage(currentEditingCabinet.id, imageInput.files[0]);
    }
    
    showMessage('Schrank erfolgreich aktualisiert!', 'success');
    
    await loadCabinets();
    closeEditCabinet();
    
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
    
  } catch (error) {
    console.error('Fehler beim Aktualisieren:', error);
    showMessage(`Fehler beim Aktualisieren: ${error.message}`, 'error');
    
    const submitBtn = form.querySelector('button[type="submit"]');
    if (submitBtn) {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  }
}

// IMAGE HANDLING
function handleCabinetImageSelect(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  if (!file.type.startsWith('image/')) {
    showMessage('Bitte w√§hle eine Bilddatei aus.', 'warning');
    return;
  }
  
  if (file.size > 5 * 1024 * 1024) {
    showMessage('Die Datei ist zu gro√ü. Maximum: 5MB', 'warning');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = (e) => {
    const preview = document.getElementById('cabinet-image-preview');
    if (preview) {
      preview.innerHTML = `
        <div style="position: relative; display: inline-block; margin-top: var(--space-md);">
          <img src="${e.target.result}" alt="Vorschau" style="max-width: 300px; max-height: 200px; border-radius: var(--radius-md);">
          <button type="button" onclick="removeCabinetImagePreview()" style="position: absolute; top: 8px; right: 8px; width: 32px; height: 32px; background: rgba(255, 107, 107, 0.9); border: none; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
          <div style="margin-top: var(--space-sm); font-size: 0.875rem; color: var(--gray-600);">${file.name}</div>
        </div>
      `;
    }
  };
  reader.readAsDataURL(file);
}

function removeCabinetImagePreview() {
  const preview = document.getElementById('cabinet-image-preview');
  const input = document.getElementById('cabinet-image-input');
  
  if (preview) preview.innerHTML = '';
  if (input) input.value = '';
}

function removeCabinetImage() {
  if (currentEditingCabinet) {
    currentEditingCabinet.removeImage = true;
    const container = document.getElementById('current-cabinet-image');
    if (container) {
      container.innerHTML = '<p style="color: var(--gray-500); font-style: italic;">Foto wird beim Speichern entfernt</p>';
    }
  }
}

// API HELPER FUNCTIONS
async function updateCabinetName(cabinetId, newName) {
  // This would need to be implemented in your API
  const response = await fetch(`/api/schraenke/${cabinetId}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ name: newName })
  });
  
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error || 'Fehler beim Aktualisieren des Namens');
  }
  
  return response.json();
}

async function uploadCabinetImage(cabinetId, imageFile) {
  // This would need to be implemented in your API
  const formData = new FormData();
  formData.append('image', imageFile);
  
  const response = await fetch(`/api/schraenke/${cabinetId}/bild`, {
    method: 'POST',
    body: formData
  });
  
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error || 'Fehler beim Hochladen des Bildes');
  }
  
  return response.json();
}

// MODAL FUNCTIONS
function openModal(modalId) {
  console.log('üìñ √ñffne Modal:', modalId);
  const modal = document.getElementById(modalId);
  if (modal) {
    // Original working code FIRST
    modal.style.display = 'flex';
    modal.style.opacity = '1';
    modal.style.visibility = 'visible';
    modal.style.zIndex = '2000';
    modal.classList.add('active');
    
    // THEN add animation
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
    
    console.log('‚úÖ Modal ge√∂ffnet:', modalId, modal);
  } else {
    console.error('‚ùå Modal nicht gefunden:', modalId);
  }
}

function closeModal(modalId) {
  console.log('üìï Schlie√üe Modal:', modalId);
  const modal = document.getElementById(modalId);
  if (modal) {
    // Remove animation classes first
    modal.classList.remove('show');
    
    // Then original working code
    setTimeout(() => {
      modal.classList.remove('active');
      modal.style.display = 'none';
    }, 400);
  }
}

function closeEditCabinet() {
  closeModal('edit-cabinet-modal');
  currentEditingCabinet = null;
  
  // Clear form
  const form = document.getElementById('edit-cabinet-form');
  if (form) form.reset();
  
  const preview = document.getElementById('cabinet-image-preview');
  if (preview) preview.innerHTML = '';
}

// Globale Funktionen f√ºr Schrank-Karten
window.editCabinet = editCabinet;
window.viewCabinetDetails = async function(cabinetId) {
  console.log('üëÅÔ∏è √ñffne Schrank-Details f√ºr ID:', cabinetId);
  currentViewingCabinetId = cabinetId;
  
  const cabinet = cabinets.find(c => c.id === cabinetId);
  if (!cabinet) {
    showMessage('Schrank nicht gefunden', 'error');
    return;
  }
  
  const modalTitle = document.getElementById('cabinet-modal-title');
  if (modalTitle) {
    modalTitle.textContent = `Schrank: ${cabinet.name}`;
  }

  const contentsCount = document.getElementById('contents-count');
  if (contentsCount) {
    contentsCount.textContent = cabinet.componentCount;
  }
  
  const tbody = document.getElementById('contents-tbody');
  const emptyState = document.getElementById('empty-cabinet');
  const tableContainer = document.querySelector('.contents-table-container');
  
  if (tbody) {
    tbody.innerHTML = '';
    
    if (cabinet.components.length === 0) {
      if (emptyState) emptyState.style.display = 'block';
      if (tableContainer) tableContainer.style.display = 'none';
    } else {
      if (emptyState) emptyState.style.display = 'none';
      if (tableContainer) tableContainer.style.display = 'block';
      
      cabinet.components.forEach(component => {
        const row = document.createElement('tr');
        const safeName = (component.name || 'Unbenannt').replace(/'/g, '&apos;');
        const safeBarcode = (component.barcode || '').replace(/'/g, '&apos;');
        
        row.innerHTML = `
          <td style="width: 60px;">
            ${component.image_url ? 
              `<img src="${component.image_url}" alt="${component.name}" style="width: 40px; height: 40px; object-fit: cover; border-radius: var(--radius-sm);" loading="lazy">` :
              '<div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: var(--gray-50); border-radius: var(--radius-sm); font-size: 1.25rem;">üì¶</div>'
            }
          </td>
          <td style="font-family: var(--font-mono);">${component.barcode}</td>
          <td>${component.name || 'Unbenannt'}</td>
          <td>${component.project || '-'}</td>
          <td>
            <div style="display: flex; gap: var(--space-xs);">
              <button class="modern-btn modern-btn-secondary" style="padding: var(--space-xs) var(--space-sm); font-size: 0.875rem;" onclick="window.open('/edit-component.html?barcode=${encodeURIComponent(component.barcode)}', '_blank')">
                Bearbeiten
              </button>
              <button class="modern-btn" style="background: #FF6B6B; border-color: #FF6B6B; color: white; padding: var(--space-xs) var(--space-sm); font-size: 0.875rem;" onclick="removeComponentFromCabinet('${safeBarcode}', ${cabinetId})">
                Auslagern
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(row);
      });
    }
  }
  
  openModal('cabinet-details-modal');
};

function closeCabinetDetails() {
  closeModal('cabinet-details-modal');
  currentViewingCabinetId = null;
}

window.removeComponentFromCabinet = async function(barcode, cabinetId) {
  if (!barcode) {
    showMessage('Fehler: Kein Barcode angegeben', 'error');
    return;
  }
  
  try {
    await api.removeComponent(barcode);
    showMessage('Bauteil erfolgreich ausgelagert!', 'success');
    
    await loadCabinets();
    await updateStats();
    
    if (currentViewingCabinetId === cabinetId) {
      window.viewCabinetDetails(cabinetId);
    }
    
  } catch (error) {
    console.error('Fehler beim Auslagern:', error);
    showMessage(`Fehler beim Auslagern: ${error.message}`, 'error');
  }
};

function closeDeleteConfirmation() {
  closeModal('delete-confirmation-modal');
  currentCabinetToDelete = null;
}

async function handleConfirmDelete() {
  if (!currentCabinetToDelete) return;
  
  try {
    await api.deleteCabinet(currentCabinetToDelete.id);
    
    showMessage(`Schrank "${currentCabinetToDelete.name}" wurde erfolgreich gel√∂scht.`, 'success');
    
    cabinets = cabinets.filter(c => c.id !== currentCabinetToDelete.id);
    
    renderCabinets();
    await updateStats();
    
    closeDeleteConfirmation();
    
  } catch (error) {
    console.error('Fehler beim L√∂schen:', error);
    showMessage(`Fehler beim L√∂schen: ${error.message}`, 'error');
  }
}

window.showCabinetDeleteConfirmation = function(cabinetId) {
  const cabinet = cabinets.find(c => c.id === cabinetId);
  if (!cabinet) {
    showMessage('Schrank nicht gefunden', 'error');
    return;
  }
  
  currentCabinetToDelete = cabinet;
  
  const message = cabinet.componentCount > 0 ?
    `M√∂chten Sie den Schrank "${cabinet.name}" wirklich l√∂schen?\n\nEr enth√§lt noch ${cabinet.componentCount} Bauteile. Diese werden automatisch ausgelagert.` :
    `M√∂chten Sie den leeren Schrank "${cabinet.name}" wirklich l√∂schen?`;
  
  const confirmationMessage = document.getElementById('delete-confirmation-message');
  if (confirmationMessage) {
    confirmationMessage.textContent = message;
  }
  
  openModal('delete-confirmation-modal');
};

async function updateStats() {
  try {
    const totalCabinets = cabinets.length;
    const totalComponents = cabinets.reduce((sum, cabinet) => sum + cabinet.componentCount, 0);
    
    const updateElement = (id, value) => {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    };
    
    updateElement('total-cabinets', totalCabinets);
    updateElement('total-components', totalComponents);
    
    console.log('üìä Statistiken aktualisiert:', { totalCabinets, totalComponents });
  } catch (error) {
    console.error('‚ùå Fehler beim Aktualisieren der Statistiken:', error);
  }
}

window.exportAllCabinets = async function() {
  try {
    const allData = [];
    
    for (const cabinet of cabinets) {
      for (const component of cabinet.components) {
        allData.push({
          'Schrank': cabinet.name,
          'Schrank-ID': cabinet.id,
          'Barcode': component.barcode,
          'Name': component.name || 'Unbenannt',
          'Projekt': component.project || '-',
          'Verantwortlicher': component.responsible_engineer || '-',
          'Ger√§tebezeichnung': component.equipment_name || '-',
          'ID-Nummer': component.identification_number || '-'
        });
      }
    }
    
    if (allData.length === 0) {
      showMessage('Keine Bauteile zum Exportieren vorhanden.', 'warning');
      return;
    }
    
    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
    
    // Convert to CSV
    const headers = Object.keys(allData[0]);
    const csvContent = [
      headers.join(','),
      ...allData.map(row => headers.map(header => {
        const value = row[header] || '';
        if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
          return `"${value.replace(/"/g, '""')}"`;
        }
        return value;
      }).join(','))
    ].join('\n');
    
    // Download CSV
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `weaselparts_alle_schraenke_${timestamp}.csv`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    
    showMessage('CSV Export erfolgreich heruntergeladen', 'success');
    
  } catch (error) {
    console.error('Fehler beim Exportieren:', error);
    showMessage(`Fehler beim Exportieren: ${error.message}`, 'error');
  }
};

async function exportCabinetContents(cabinetId) {
  try {
    const cabinet = cabinets.find(c => c.id === cabinetId);
    if (!cabinet) {
      showMessage('Schrank nicht gefunden', 'error');
      return;
    }

    if (cabinet.components.length === 0) {
      showMessage('Dieser Schrank ist leer - nichts zu exportieren.', 'warning');
      return;
    }
    
    const exportData = cabinet.components.map(component => ({
      'Barcode': component.barcode,
      'Name': component.name || 'Unbenannt',
      'Projekt': component.project || '-',
      'Verantwortlicher': component.responsible_engineer || '-',
      'Ger√§tebezeichnung': component.equipment_name || '-',
      'ID-Nummer': component.identification_number || '-'
    }));
    
    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
    
    // Convert to CSV
    const headers = Object.keys(exportData[0]);
    const csvContent = [
      headers.join(','),
      ...exportData.map(row => headers.map(header => {
        const value = row[header] || '';
        if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
          return `"${value.replace(/"/g, '""')}"`;
        }
        return value;
      }).join(','))
    ].join('\n');
    
    // Download CSV
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `weaselparts_${cabinet.name}_${timestamp}.csv`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    
    showMessage('CSV Export erfolgreich heruntergeladen', 'success');
    
  } catch (error) {
    console.error('Fehler beim Exportieren:', error);
    showMessage(`Fehler beim Exportieren: ${error.message}`, 'error');
  }
}

// Global functions
window.handleCabinetImageSelect = handleCabinetImageSelect;
window.removeCabinetImagePreview = removeCabinetImagePreview;
window.removeCabinetImage = removeCabinetImage;
window.closeEditCabinet = closeEditCabinet;

// Sensor Data Functions
async function loadSensorData() {
  try {
    const locationSelect = document.getElementById('sensor-location-select');
    const location = locationSelect ? locationSelect.value : 'ssa';
    
    const response = await fetch(`/api/sensors/current/${location}`);
    if (!response.ok) return;
    
    const sensorData = await response.json();
    updateSensorDisplay(sensorData);
  } catch (error) {
    console.error('‚ùå Sensordaten Fehler:', error);
  }
}

function updateSensorDisplay(data) {
  try {
    // Temperature
    const tempValue = document.getElementById('temperature-value');
    if (tempValue) {
      if (data.temperature && data.temperature.temperature !== null && !isNaN(data.temperature.temperature)) {
        tempValue.textContent = `${data.temperature.temperature.toFixed(1)}¬∞C`;
      } else {
        tempValue.textContent = '--¬∞C';
      }
    }
    
    // Humidity
    const humValue = document.getElementById('humidity-value');
    if (humValue) {
      if (data.humidity && data.humidity.humidity !== null && !isNaN(data.humidity.humidity)) {
        humValue.textContent = `${data.humidity.humidity.toFixed(1)}%`;
      } else {
        humValue.textContent = '--%';
      }
    }
    
    // Debug-Info bei Fehler
    if (data.error || data.warning) {
      console.warn('‚ö†Ô∏è Sensordaten-Warnung:', data.errorMessage || data.warning);
    }
  } catch (error) {
    console.error('‚ùå Fehler beim Aktualisieren der Sensoranzeige:', error);
  }
}

function startSensorRefresh() {
  setInterval(async () => {
    await loadSensorData();
  }, 30000);
}

// Message display function
function showMessage(message, type = 'info') {
  console.log(`${type.toUpperCase()}: ${message}`);
  
  // Create toast element
  const toast = document.createElement('div');
  toast.className = `modern-toast ${type}`;
  toast.innerHTML = `
    <div style="display: flex; align-items: center; gap: 12px;">
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        ${type === 'success' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>' :
          type === 'error' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>' :
          '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'}
      </svg>
      <span>${message}</span>
    </div>
  `;
  
  document.body.appendChild(toast);
  
  // Remove after 4 seconds
  setTimeout(() => {
    toast.remove();
  }, 4000);
}
</script>

<style>
/* Additional Styles for Cabinet Management */
.stats-container {
  padding: 0;
  margin-bottom: var(--space-xl);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-lg);
}

.stat-card {
  background: var(--white);
  border: 1px solid var(--black);
  border-radius: 0;
  padding: var(--space-lg);
  display: flex;
  align-items: center;
  gap: var(--space-lg);
  transition: all 0.2s ease;
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.stat-icon {
  color: var(--table-header-primary);
  flex-shrink: 0;
}

.stat-content {
  flex: 1;
}

.stat-value {
  font-size: 2rem;
  font-weight: 900;
  margin: 0 0 var(--space-xs) 0;
  color: var(--gray-900);
  font-family: var(--font-mono);
}

.stat-label {
  font-size: 0.875rem;
  color: var(--gray-600);
  font-weight: 600;
  margin: 0;
}

.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-xl);
}

.add-cabinet-form {
  display: flex;
  gap: var(--space-lg);
  align-items: end;
}

.cabinet-card {
  overflow: hidden;
  transition: all 0.2s ease;
  position: relative;
}

.cabinet-card:hover {
  transform: translateY(-2px);
}

.cabinet-header {
  position: relative;
  overflow: hidden;
}

.component-count {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1.125rem;
  box-shadow: var(--shadow-md);
}

.image-upload-container {
  margin-top: var(--space-md);
}

.current-image-section {
  margin-bottom: var(--space-md);
}

.image-preview {
  margin-top: var(--space-md);
}



/* Background-Icon rechts - Original Farbe und gr√∂√üer */
.cabinet-bg-icon {
  opacity: 1 !important;
  filter: none !important;
  width: 80% !important;
  max-width: 400px !important;
}

/* Cabinet Action Buttons - FUNKTIONAL UND SCH√ñN */

/* Modal Styles - Original working code + Animation */
.modern-modal {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  background: rgba(0, 0, 0, 0.5) !important;
  z-index: 2000 !important;
  display: none !important;
  align-items: center !important;
  justify-content: center !important;
}

.modern-modal.active {
  display: flex !important;
}

/* ADD slide-up animation on top */
.modern-modal-content {
  transform: translateY(100px);
  opacity: 0;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.modern-modal.show .modern-modal-content {
  transform: translateY(0);
  opacity: 1;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .add-cabinet-form {
    flex-direction: column;
    align-items: stretch;
  }
  
  .add-cabinet-form .modern-form-group {
    margin-bottom: var(--space-md);
  }
  
  .section-header {
    flex-direction: column;
    gap: var(--space-md);
    align-items: stretch;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
}
</style>

</body>
</html>