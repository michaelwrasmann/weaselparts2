<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeaselParts - Historical Record</title>
  <link rel="stylesheet" href="/css/modern-styles.css">
  <!-- Page Transitions -->
  <script src="/js/page-transitions.js"></script>
  <!-- Modal Animations -->
  <script src="/js/modal-animations.js"></script>
</head>
<body class="page-historical">

<div class="modern-container">
  <!-- Modern Header -->
  <header class="modern-header">
    <nav class="modern-nav">
      <a href="/" class="modern-logo">
        <img src="/images/weasel-svgrepo-com.svg" alt="WeaselParts">
        <span>WeaselParts</span>
      </a>
      
      <!-- Search Bar -->
      <div class="modern-search">
        <input type="text" placeholder="Bauteile suchen..." id="global-search">
      </div>
      
      <!-- Sensor Data -->
      <div class="modern-sensors">
        <div class="modern-sensor temp" id="temperature-value">--°C</div>
        <div class="modern-sensor humid" id="humidity-value">--%</div>
        <select class="modern-select" id="sensor-location-select" style="width: auto; padding: 4px 8px;">
          <option value="ssa">Jarvis-Ecke</option>
          <option value="int_up">Am Telefon</option>
          <option value="emp">Empore</option>
        </select>
      </div>
      
      <!-- Navigation Buttons -->
      <div class="modern-nav-buttons">
        <button class="modern-nav-btn" id="add-component-nav-btn" title="Neues Bauteil">
          <img src="/images/button_add_component.png" alt="Neues Bauteil">
        </button>
        <button class="modern-nav-btn" id="manage-cabinets-nav-btn" title="Schränke verwalten">
          <img src="/images/button_manage_cabinet.png" alt="Schränke">
        </button>
        <a href="/ICD.html" class="modern-nav-btn" title="ICD">
          <img src="/images/button_icd.png" alt="ICD">
        </a>
        <a href="/lab-overview.html" class="modern-nav-btn" title="Labor-Übersicht">
          <img src="/images/button_lab_overview.png" alt="Labor">
        </a>
        <a href="/glue-protocol.html" class="modern-nav-btn" title="Klebeprotokoll">
          <img src="/images/button_glue_protocol.png" alt="Kleben">
        </a>
        <a href="/settings.html" class="modern-nav-btn" title="Einstellungen">
          <img src="/images/button_settings.png" alt="Settings">
        </a>
      </div>
    </nav>
  </header>

  <!-- Split Screen Layout -->
  <div class="modern-wrapper">
    <!-- Content Panel - Left Side 60% -->
    <div class="content-panel">
      <div class="modern-content">
        
        <!-- Page Header -->
        <div class="modern-page-header">
          <h1 class="modern-title">Historical Record</h1>
          <div class="component-info-header" id="component-info-header">
            <p class="modern-subtitle">Lade Bauteilinformationen...</p>
          </div>
        </div>

        <!-- Activity Records Container -->
        <div class="activity-records-container">
          <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-xl); flex-wrap: wrap; gap: var(--space-md);">
            <h2 style="font-size: 1.5rem; font-weight: 700; margin: 0;">Historical Records</h2>
            <div class="header-actions" style="display: flex; gap: var(--space-md); flex-wrap: wrap; align-items: center;">
              <div class="export-buttons" style="display: flex; gap: var(--space-sm);">
                <button class="modern-btn modern-btn-secondary" id="export-csv-btn">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  CSV Export
                </button>
                <button class="modern-btn modern-btn-secondary" id="export-pdf-btn">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                  </svg>
                  PDF Export
                </button>
              </div>
              <button class="modern-btn modern-btn-primary" id="add-activity-btn">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Eintrag hinzufügen
              </button>
            </div>
          </div>

          <!-- Activity Records Table -->
          <div class="table-container">
            <table class="modern-table" id="activity-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Datum</th>
                  <th>Eingetragen von</th>
                  <th>Organisation</th>
                  <th>Ort</th>
                  <th>Aktivitäten</th>
                  <th>Prozedur Nr.</th>
                  <th>Zeit</th>
                  <th>rel.Luftf.</th>
                  <th>Temp.</th>
                  <th>Aktionen</th>
                </tr>
              </thead>
              <tbody id="activity-table-body">
                <!-- Activity records will be loaded here -->
              </tbody>
            </table>
            
            <div class="no-activities" id="no-activities" style="display: none; text-align: center; padding: var(--space-3xl); color: var(--gray-500);">
              <p style="margin-bottom: var(--space-lg);">Noch keine Historical Records vorhanden.</p>
              <button class="modern-btn modern-btn-primary" id="add-first-activity">Ersten Eintrag erstellen</button>
            </div>
          </div>
        </div>

      </div>
    </div>
    
    <!-- Background Panel - Right Side 40% -->
    <div class="background-panel">
      <img src="/images/background_icon_historical_record.png" alt="Historical Record Icon" class="background-icon" onerror="this.src='/images/background_icon_lab_overview.png'">
    </div>
  </div>
</div>

<!-- Activity Record Modal -->
<div id="activity-modal" class="modal modern-modal">
  <div class="modal-content modern-modal-content" style="max-width: 800px;">
    <div class="modern-modal-header modal-titlebar">
      <h3 id="activity-modal-title">Historical Record hinzufügen</h3>
      <button class="modal-close-btn" id="close-activity-modal">✕</button>
    </div>
    
    <div class="modern-modal-body">
      <form id="activity-form">
        <!-- General Entry Data Section -->
        <div style="margin-bottom: var(--space-xl);">
          <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-lg); color: var(--table-header-primary);">Allgemeine Eingabedaten</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg);">
            <div class="modern-form-group">
              <label class="modern-label" for="entry-made-by">Eingetragen von (Nachname) *</label>
              <select id="entry-made-by" name="entry_made_by" class="modern-select" required>
                <option value="">Mitarbeiter auswählen...</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="organisation">Organisation</label>
              <input type="text" id="organisation" name="organisation" class="modern-input">
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
            <div class="modern-form-group">
              <label class="modern-label" for="location">Ort</label>
              <input type="text" id="location" name="location" class="modern-input">
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="further-operators">Weitere Bearbeiter</label>
              <select id="further-operators" name="further_operators" class="modern-select" multiple>
                <option value="">Weitere Mitarbeiter auswählen...</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Activity Type Section -->
        <div style="margin-bottom: var(--space-xl);">
          <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-lg); color: var(--table-header-primary);">Aktivitätsart und Instanz</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
            <div class="modern-form-group">
              <label class="modern-label" for="activity-type">Aktivitätstyp *</label>
              <select id="activity-type" name="activity_type" class="modern-select" required>
                <option value="">Bitte wählen...</option>
                <option value="ASSY">ASSY</option>
                <option value="DISASSY">DISASSY</option>
                <option value="TEST">TEST</option>
                <option value="SHPF">SHPF</option>
                <option value="INSP">INSP</option>
                <option value="CLN">CLN</option>
                <option value="SMPL">SMPL</option>
                <option value="CAL">CAL</option>
                <option value="HNDL">HNDL</option>
                <option value="STOR">STOR</option>
                <option value="DE-STOR">DE-STOR</option>
              </select>
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="procedure-number">Prozedur Nr.</label>
              <input type="text" id="procedure-number" name="procedure_number" class="modern-input">
            </div>
          </div>
        </div>

        <!-- Date and Time Section -->
        <div style="margin-bottom: var(--space-xl);">
          <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-lg); color: var(--table-header-primary);">Datum und Zeit</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-lg);">
            <div class="modern-form-group">
              <label class="modern-label" for="activity-date">Datum</label>
              <input type="date" id="activity-date" name="date" class="modern-input">
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="start-time">Startzeit</label>
              <input type="time" id="start-time" name="start_time" class="modern-input">
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="end-time">Endzeit</label>
              <input type="time" id="end-time" name="end_time" class="modern-input">
            </div>
          </div>
        </div>

        <!-- Environmental Conditions Section -->
        <div style="margin-bottom: var(--space-xl);">
          <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-lg); color: var(--table-header-primary);">Umgebungsbedingungen</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg);">
            <div class="modern-form-group">
              <label class="modern-label" for="humidity-start">Luftfeuchtigkeit Start (%)</label>
              <input type="number" id="humidity-start" name="humidity_start" min="0" max="100" step="0.1" class="modern-input">
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="humidity-end">Luftfeuchtigkeit Ende (%)</label>
              <input type="number" id="humidity-end" name="humidity_end" min="0" max="100" step="0.1" class="modern-input">
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
            <div class="modern-form-group">
              <label class="modern-label" for="temperature-start">Temperatur Start (°C)</label>
              <input type="number" id="temperature-start" name="temperature_start" step="0.1" class="modern-input">
            </div>
            <div class="modern-form-group">
              <label class="modern-label" for="temperature-end">Temperatur Ende (°C)</label>
              <input type="number" id="temperature-end" name="temperature_end" step="0.1" class="modern-input">
            </div>
          </div>
        </div>

        <!-- Remarks Section -->
        <div style="margin-bottom: var(--space-xl);">
          <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-lg); color: var(--table-header-primary);">Bemerkungen, Aktivitätsbeschreibung, Berichte</h4>
          <div class="modern-form-group" style="margin-bottom: var(--space-lg);">
            <label class="modern-label" for="remarks">Bemerkungen</label>
            <textarea id="remarks" name="remarks" rows="3" class="modern-textarea"></textarea>
          </div>
          <div class="modern-form-group" style="margin-bottom: var(--space-lg);">
            <label class="modern-label" for="activity-description">Aktivitätsbeschreibung</label>
            <textarea id="activity-description" name="activity_description" rows="3" class="modern-textarea"></textarea>
          </div>
          <div class="modern-form-group">
            <label class="modern-label" for="reports">Berichte</label>
            <textarea id="reports" name="reports" rows="3" class="modern-textarea"></textarea>
          </div>
        </div>

      </form>
    </div>
    
    <div class="modern-modal-footer">
      <button type="button" class="modern-btn modern-btn-secondary" id="cancel-activity">Abbrechen</button>
      <button type="submit" class="modern-btn modern-btn-primary" id="save-activity" form="activity-form">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        Speichern
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-activity-modal" class="modal modern-modal">
  <div class="modal-content modern-modal-content" style="max-width: 500px;">
    <div class="modern-modal-header modal-titlebar">
      <h3>Historical Record löschen</h3>
      <button class="modal-close-btn" id="close-delete-modal">✕</button>
    </div>
    
    <div class="modern-modal-body" style="text-align: center;">
      <div style="margin-bottom: var(--space-lg);">
        <svg width="60" height="60" fill="none" stroke="#FF6B6B" viewBox="0 0 24 24" style="margin: 0 auto;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
      </div>
      
      <div style="margin-bottom: var(--space-xl);">
        <p style="margin-bottom: var(--space-md); font-size: 1.125rem;">Möchten Sie diesen Historical Record wirklich löschen?</p>
        <div style="background: #FFF3F3; border: 1px solid #FFB3B3; border-radius: var(--radius-md); padding: var(--space-md);">
          <strong>Achtung:</strong> Diese Aktion kann nicht rückgängig gemacht werden.
        </div>
      </div>
    </div>
      
    <div class="modern-modal-footer">
      <button class="modern-btn modern-btn-secondary" id="cancel-delete-activity">Abbrechen</button>
      <button class="modern-btn modern-btn-primary" id="confirm-delete-activity" style="background: #FF6B6B; border-color: #FF6B6B;">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        Löschen
      </button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Scripts -->
<script src="/js/api.js"></script>
<script src="/js/common.js"></script>
<script src="/js/historical-record.js"></script>

<script>
// Setup Navigation - Let page-transitions.js handle these
document.addEventListener('DOMContentLoaded', () => {
  const globalSearch = document.getElementById('global-search');
  if (globalSearch) {
    globalSearch.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.target.value.trim()) {
        window.location.href = `/?search=${encodeURIComponent(e.target.value)}`;
      }
    });
  }
});
</script>

</body>
</html>