<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeaselParts - Historical Record</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script src="/js/modal-fixes.js"></script>
</head>
<body>
<header>
  <div class="header-content">
    <a href="/" class="logo">
      <svg class="logo-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
        <path fill="currentColor" d="M508.862,112.381c-4.797-3.806-47.682-37.184-75.929-37.184c-27.581,0-52.308,23.844-69.626,67.139c-10.743,26.856-24.697,26.856-38.192,26.856c-5.776,0-20.502-2.82-34.744-5.548c-20.389-3.905-43.49-8.33-57.625-8.275c-14.746,0.057-52.816,3.26-87.728,31.698c-31.702,25.822-51.001,65.459-56.011,114.89c-8.069,2.417-23.771,7.404-39.669,14.027C15.677,330.01,0,343.277,0,357.737c0,21.496,16.178,42.239,45.556,58.41c22.094,12.163,50.426,20.657,68.898,20.657c24.792,0,41.517-16.152,43.365-31.767c1.286-10.873-4.274-24.152-23.736-28.825c-19.624-4.71-34.346-10.988-44.13-16.064c11.112-2.083,23.886-2.809,31.072-2.94c4.073,2.64,14.61,9.738,24.149,16.231c1.376,0.938,3.002,1.439,4.668,1.439h70.773c3.118,0,5.973-1.748,7.389-4.526s1.156-6.115-0.677-8.639l-13.728-18.914c2.637-2.415,5.107-5.066,7.332-8.005c5.195-6.864,8.692-14.66,10.543-23.318c13.559-1.22,56.52-5.8,84.509-16.876c9.94,14.204,21.305,29.862,21.499,30.128c6.448,8.878,15.779,21.586,23.615,31.712c11.772,15.211,14.051,17.314,18.758,17.314h44.233c3.059,0,5.87-1.684,7.313-4.38c1.443-2.697,1.285-5.969-0.412-8.514l-14.236-21.355c-4.011-6.015-11.166-8.898-18.224-7.349l-2.914,0.64c-7.463-14.329-16.73-35.639-16.32-45.486c0.111-2.656,0.332-4.95,0.636-7.011c23.591-9.243,60.487-37.432,69.947-80.001c4.407-19.833,8.867-44.304,8.911-44.548c0.159-0.874,0.171-1.738,0.061-2.572c16.615-1.917,37.452-8.366,38.481-8.686c2.154-0.671,3.941-2.192,4.95-4.209l8.847-17.693C512.879,119.077,511.935,114.819,508.862,112.381z"/>
      </svg>
      <h1>WeaselParts</h1>
    </a>
    <nav class="top-nav">
      <div class="nav-left">
        <div class="lab-info">
          <span class="lab-name">Integrationslabor</span>
          <div class="mini-sensors">
            <span class="mini-sensor temp">
              <span id="temperature-value">--°C</span>
            </span>
            <span class="mini-sensor humid">
              <span id="humidity-value">--%</span>
            </span>
          </div>
        </div>
        <div class="search-container">
          <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input type="text" placeholder="Bauteile suchen" id="global-search">
        </div>
      </div>
      <div class="nav-icons">
        <button class="nav-btn" id="add-component-nav-btn" title="Neues Bauteil">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V18M18 12L6 12"></path>
          </svg>
        </button>
        <button class="nav-btn" id="manage-cabinets-nav-btn" title="Schränke verwalten">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
          </svg>
        </button>
        <a href="/ICD.html" class="nav-btn" title="ICD">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
        </a>
      </div>
    </nav>
  </div>
</header>

<main class="main-content">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">Historical Record</h1>
    <div class="component-info-header" id="component-info-header">
      <p class="page-subtitle">Lade Bauteilinformationen...</p>
    </div>
  </div>

  <!-- Activity Records Container -->
  <div class="activity-records-container">
    <div class="section-header">
      <h2 class="section-title">Historical Records</h2>
      <div class="header-actions">
        <div class="export-buttons">
          <button class="btn secondary export-btn" id="export-csv-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            CSV Export
          </button>
          <button class="btn secondary export-btn" id="export-pdf-btn">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
            </svg>
            PDF Export
          </button>
        </div>
        <button class="add-btn" id="add-activity-btn">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
          </svg>
          Eintrag hinzufügen
        </button>
      </div>
    </div>

    <!-- Activity Records Table -->
    <div class="activity-table-container">
      <table class="activity-table" id="activity-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Datum</th>
            <th>Eingetragen von</th>
            <th>Organisation</th>
            <th>Ort</th>
            <th>Aktivitäten</th>
            <th>Prozedur Nr.</th>
            <th>Zeit</th>
            <th>Luftfeuchtigkeit</th>
            <th>Temperatur</th>
            <th>Aktionen</th>
          </tr>
        </thead>
        <tbody id="activity-table-body">
          <!-- Activity records will be loaded here -->
        </tbody>
      </table>
      
      <div class="no-activities" id="no-activities" style="display: none;">
        <p>Noch keine Historical Records vorhanden.</p>
        <button class="btn primary" id="add-first-activity">Ersten Eintrag erstellen</button>
      </div>
    </div>
  </div>
</main>

<!-- Activity Record Modal -->
<div id="activity-modal" class="modal" style="display: none;">
  <div class="modal-content activity-modal-content">
    <div class="modal-header">
      <h3 id="activity-modal-title">Neuer Historical Record</h3>
      <button class="close-modal" id="close-activity-modal">&times;</button>
    </div>
    
    <form id="activity-form" class="activity-form">
      <!-- General Entry Data Section -->
      <div class="form-section">
        <h4>Allgemeine Eingabedaten</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="entry-made-by">Eingetragen von (Nachname) *</label>
            <input type="text" id="entry-made-by" name="entry_made_by" required>
          </div>
          <div class="form-group">
            <label for="organisation">Organisation</label>
            <input type="text" id="organisation" name="organisation">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="location">Ort</label>
            <input type="text" id="location" name="location">
          </div>
          <div class="form-group">
            <label for="further-operators">Weitere Bearbeiter</label>
            <textarea id="further-operators" name="further_operators" rows="2"></textarea>
          </div>
        </div>
      </div>

      <!-- Activity Type Section -->
      <div class="form-section">
        <h4>Aktivitätsart und Instanz</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="activity-type">Aktivitätstyp *</label>
            <select id="activity-type" name="activity_type" required>
              <option value="">Bitte wählen...</option>
              <option value="ASSY">ASSY</option>
              <option value="DISASSY">DISASSY</option>
              <option value="TEST">TEST</option>
              <option value="SHPF">SHPF</option>
              <option value="INSP">INSP</option>
              <option value="CLN">CLN</option>
              <option value="SMPL">SMPL</option>
              <option value="CAL">CAL</option>
              <option value="HNDL">HNDL</option>
              <option value="STOR">STOR</option>
              <option value="DE-STOR">DE-STOR</option>
            </select>
          </div>
          <div class="form-group">
            <label for="procedure-number">Prozedur Nr.</label>
            <input type="text" id="procedure-number" name="procedure_number">
          </div>
        </div>
      </div>

      <!-- Date and Time Section -->
      <div class="form-section">
        <h4>Datum und Zeit</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="activity-date">Datum</label>
            <input type="date" id="activity-date" name="date">
          </div>
          <div class="form-group">
            <label for="start-time">Startzeit</label>
            <input type="time" id="start-time" name="start_time">
          </div>
          <div class="form-group">
            <label for="end-time">Endzeit</label>
            <input type="time" id="end-time" name="end_time">
          </div>
        </div>
      </div>

      <!-- Environmental Conditions Section -->
      <div class="form-section">
        <h4>Umgebungsbedingungen</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="humidity-start">Luftfeuchtigkeit Start (%)</label>
            <input type="number" id="humidity-start" name="humidity_start" min="0" max="100" step="0.1">
          </div>
          <div class="form-group">
            <label for="humidity-end">Luftfeuchtigkeit Ende (%)</label>
            <input type="number" id="humidity-end" name="humidity_end" min="0" max="100" step="0.1">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="temperature-start">Temperatur Start (°C)</label>
            <input type="number" id="temperature-start" name="temperature_start" step="0.1">
          </div>
          <div class="form-group">
            <label for="temperature-end">Temperatur Ende (°C)</label>
            <input type="number" id="temperature-end" name="temperature_end" step="0.1">
          </div>
        </div>
      </div>

      <!-- Remarks Section -->
      <div class="form-section">
        <h4>Bemerkungen, Aktivitätsbeschreibung, Berichte</h4>
        <div class="form-group">
          <label for="remarks">Bemerkungen</label>
          <textarea id="remarks" name="remarks" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="activity-description">Aktivitätsbeschreibung</label>
          <textarea id="activity-description" name="activity_description" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label for="reports">Berichte</label>
          <textarea id="reports" name="reports" rows="3"></textarea>
        </div>
      </div>

    </form>
    
    <div class="form-actions modal-footer">
      <button type="submit" class="btn primary" id="save-activity" form="activity-form">
        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        Speichern
      </button>
      <button type="button" class="btn secondary" id="cancel-activity">Abbrechen</button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-activity-modal" class="modal" style="display: none;">
  <div class="modal-content confirmation-content">
    <div class="modal-header danger">
      <h3>Historical Record löschen</h3>
      <button class="close-modal" id="close-delete-modal">&times;</button>
    </div>
    
    <div class="confirmation-body">
      <div class="warning-icon">
        <svg width="60" height="60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
      </div>
      
      <div class="confirmation-text">
        <p>Möchten Sie diesen Historical Record wirklich löschen?</p>
        <div class="warning-note">
          <strong>Achtung:</strong> Diese Aktion kann nicht rückgängig gemacht werden.
        </div>
      </div>
      
      <div class="confirmation-actions">
        <button class="btn danger" id="confirm-delete-activity">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
          Ja, löschen
        </button>
        <button class="btn secondary" id="cancel-delete-activity">Abbrechen</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="/js/api.js"></script>
<script src="/js/common.js"></script>
<script src="/js/historical-record.js"></script>

<style>
  /* Navigation Lab Info Styles */
  .nav-left {
    display: flex;
    align-items: center;
    gap: 24px;
    flex: 1;
  }

  .lab-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .lab-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .mini-sensors {
    display: flex;
    gap: 12px;
  }

  .mini-sensor {
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 500;
    background: var(--bg-card);
    border: 1px solid var(--border-color);
  }

  .mini-sensor.temp {
    color: #FF6B35;
  }

  .mini-sensor.humid {
    color: #4A90E2;
  }

  @media (max-width: 768px) {
    .nav-left {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }

    .lab-info {
      align-self: stretch;
    }

    .mini-sensors {
      justify-content: space-between;
    }
  }
</style>

<script>
  // Sensordaten-Funktionen
  function updateSensorData() {
    // Simulierte Sensordaten - in der Praxis würden diese von einem API-Endpoint kommen
    const temperature = (Math.random() * 5 + 22).toFixed(1); // 22-27°C
    const humidity = (Math.random() * 10 + 45).toFixed(0); // 45-55%
    
    const tempElement = document.getElementById('temperature-value');
    const humidElement = document.getElementById('humidity-value');
    
    if (tempElement) tempElement.textContent = `${temperature}°C`;
    if (humidElement) humidElement.textContent = `${humidity}%`;
  }

  // Sensordaten alle 30 Sekunden aktualisieren
  setInterval(updateSensorData, 30000);
  // Initial einmal laden
  document.addEventListener('DOMContentLoaded', updateSensorData);
</script>

</body>
</html>